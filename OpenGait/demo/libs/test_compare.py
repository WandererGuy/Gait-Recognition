gallery_feat ={
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5234757553247363443/001':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/e33b113e-6c6e-4928-a939-09b8a9b37d82.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5167526383877495248/002':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/95cef235-02d5-4fff-b532-bd9d6302a0e6.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5167526383877495248/003':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/ac29357b-2d0f-4131-992a-ebe433df55a0.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5167526383877495248/001':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/53b0d8f5-b3f6-49f1-8b11-db523a1b7d5a.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5167526383877495248/006':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/85beee1d-aa81-48c2-b27a-da9578ca5360.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5167526383877495248/004':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/c4d9b86d-8aa4-4fc6-867d-5392e4a31144.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5167526383877495248/007':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/1b3baee0-8999-493f-86df-c0fc0affd306.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5167526383877495248/005':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/c4e23ae0-a3fe-4a56-8ca1-57810843594d.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5234757553247363443/002':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/da9af6d9-c5a8-4f35-9fed-efa52712af60.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/7180747282665697279/001':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/41b1fc27-65e6-4bb3-8e27-0121cd7110ef.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/7180747282665697279/003':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/4697504c-8a91-46b1-be13-068ca66b5285.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/001':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/80786835-896a-4f20-b910-6db174a67d09.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/7180747282665697279/002':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/813dc28c-6093-4450-b6eb-a04284e6956e.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/004':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/246cab75-44f4-412e-b4b6-3fb1f2a7ec17.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/012':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/77f9b23d-98d4-4484-bd5e-63e031c0f8b1.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/002':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/0ca32e47-91a1-4f89-9a45-65cad4588781.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8300278661057155957/001':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/b0970a4f-59ad-4f0f-982f-0a8284f2baaf.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/010':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/88a705d0-c802-4d23-98ba-6a229767bcbe.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/007':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/e6064fc9-8080-42ee-87c6-5c56b7d38b90.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/003':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/8fbf9395-1668-4077-aeac-807d85b0ad8e.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8300278661057155957/002':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/2a44f730-ee38-4289-8631-6e28f0c3054a.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/014':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/0885ca1f-d62d-4007-ae87-6726b3d6039b.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/006':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/d585ca2c-66ab-4a29-92c9-5a42d4c5cc1c.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/013':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/b66e16aa-54ba-41cc-9d96-bbc29f4e09e8.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/009':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/e9e5c916-8cbf-4384-8f85-af055829e791.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/012':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/b572fb4f-5c47-4cfc-9db5-2e72cbcba0bd.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/005':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/b8ccb198-c956-44a3-a0ee-e36f1ad92421.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442/011':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/237eb812-557c-4950-a367-7dae4c86bc12.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/017':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/1c8f5012-feaa-4b5a-ae01-7c2716dc030f.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8300278661057155957/003':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/f3a1e982-3a60-4653-997c-a3b2df9eeb24.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/009':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/5d3035e2-51df-475c-8f36-925370a516f9.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/007':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/70e747ce-0f39-43f1-9109-83ae280ccffb.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5652104598115489538 (1)/001':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/928c9106-09e3-4d10-ad9d-f6ecdfdd3938.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/004':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/fce9805d-9f62-44e0-a1fc-4eac7c7f338d.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/003':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/329981c5-7115-4d8c-81c9-77c177802f0d.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/015':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/276aac76-857c-4416-8d75-eaedea1094af.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/016':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/43d94907-3d55-48b8-af0e-66ef26418722.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/010':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/a8b9b914-1d41-431d-b4f2-978c19b9af59.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/011':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/571784fa-57cf-4444-bd38-12c99d92cea8.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/001':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/4c725eaa-1353-4c8e-9182-22d5113861b7.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/008':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/c2be8467-3206-4977-a1f1-f6751bc18458.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/5652104598115489538 (1)/004':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/70b6f805-3090-4cc2-bd11-c0115694c1a0.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/C0103/002':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/10b6bada-4293-442b-992a-f654ef13cc10.pkl'
}

probe_feat = {
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/di vao 01h28p/001':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/5b151ef6-ca52-463c-90c2-0146178ff28d.pkl',
'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/di ra 03h13p/001':'/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/f86cd319-de6c-440b-a355-3e8784c498df.pkl'
}

import os 



# multiple probe across many videos 
# multiple probe in one video
def collect_feat_in_same_video(video_path, feat_dict):
    tmp = {video_path:[]}
    for key, value in feat_dict.items():
        video_extract_path = os.path.dirname(key)
        if video_extract_path == video_path:
            tmp[video_path].append(value)
    return tmp
# {video_path: embedding_list}            
    
    
def multi_gallery_vs_single_probe(probe_feat_path, list_gallery_feat_path):
    import requests

    url = "http://10.0.68.103:2003/compare-embeddings"
    payload = {'probe_feat_path': probe_feat_path,
    'list_gallery_feat_path': list_gallery_feat_path}
    files=[
    ]
    headers = {}

    response = requests.request("POST", url, headers=headers, data=payload, files=files)

    tmp = response.json()["result"]["ranking_ls"]
    
    with open ("demo/log_compare_result.txt", "a") as f:
        for index, item in enumerate(tmp):
            value = item["gallery_feat_path"]
            # Find the key with the specific value
            key = next((k for k, v in gallery_feat.items() if v == value), None)
            f.write (str(key) + '\n')
            f.write(str(item))
            f.write('\n')
            f.write ('--------------------------------------------\n')
            if index == 4:
                break

##### PROBE 
# Get the first probe object in a probe video 
probe_first_key = next(iter(probe_feat))
# 1 gallery video vs 1 probe embed 
# Get the value of the first key
probe_first_value = probe_feat[probe_first_key]
 

#### GALLERY
#### get 1 video from track output and get its embedding corresponding 
folder_track = "/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult"
all_video = []
for filename in os.listdir(folder_track):
    video_folder = os.path.join(folder_track, filename)
    all_video.append(video_folder)
 
 # {video_path: embedding_list}            


### collect EACH gallery vid with its embedding, probe will have [] as embedding list 
tmp_ls = []
for item in all_video:
    single_video_info = collect_feat_in_same_video(item, gallery_feat)        
    tmp_ls.append(single_video_info)
# tmp_ls is [{video1:[embedding1, embedding2]}, {video2:[embedding1, embedding2]}]
for item in tmp_ls:
        first_key = next(iter(item))
        first_value = item[first_key]
        if first_value != []: # probe has no embedding in gallery feat so skip 
            sample_vid = first_value

            # multi_gallery_vs_single_probe(probe_feat_path = probe_first_value, list_gallery_feat_path = sample_vid)
print (item)
for item in tmp_ls:
    if "/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442" in item.keys():
        first_value = item["/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/output/TrackingResult/8328534836514339442"]
        multi_gallery_vs_single_probe(probe_feat_path = probe_first_value, list_gallery_feat_path = first_value)

# import requests

# url = "http://10.0.68.103:2003/compare-embeddings"

# payload = {'probe_feat_path': '/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/manh_probe_helmet.pkl',
# 'list_gallery_feat_path': ('/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/giang.pkl',
# '/home/ai-ubuntu/hddnew/Manh/GAIT_RECOG/OpenGait/demo/libs/pickle_variables/embeddings_db/giang.pkl')}
# files=[

# ]
# headers = {}

# response = requests.request("POST", url, headers=headers, data=payload, files=files)

# print(response.text)